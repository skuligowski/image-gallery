<app-header-navigation [back]="'/albums/' + album.permalink"></app-header-navigation>
<div class="admin-layout-container">
  <nav>
    <p-button class="action" i18n-label label="Add images" (click)="libraryFilesSelector.open()"></p-button>
    <p-button class="action" [disabled]="!selected.length" i18n-label label="Delete images" (click)="selected.length && removeImages(selected)"></p-button>
    <p-button class="action" i18n-label label="Modify album" (click)="albumModify.open(album);"></p-button>
    <p-button class="action" i18n-label label="Delete album" (click)="removeAlbum(album.id)"></p-button>
    <p-button class="action" [disabled]="!selected.length" i18n-label label="Create thumbnails" (click)="selected.length && createThumbnails(selected)"></p-button>
    <p-button class="action" [disabled]="!reordered" i18n-label label="Update order" (click)="setImagesOrder()"></p-button>
    <p-button class="action" [disabled]="!selected.length" i18n-label label="Batch processing" (click)="selected.length && batchProcessing.open()"></p-button>
  </nav>
  <p-table [value]="images" dataKey="url" [(selection)]="selected" (onRowReorder)="onRowReorder()">
    <ng-template pTemplate="header">
      <tr>
        <th class="checkbox-column">
          <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
        </th>
        <th style="width: 200px" i18n>Image</th>
        <th i18n>Image data</th>
        <th style="width: 80px" i18n>Move</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-image let-index="rowIndex">
      <tr [pReorderableRow]="index">
        <td class="checkbox-column">
          <p-tableCheckbox [value]="image"></p-tableCheckbox>
        </td>
        <td>
          <img class="image-preview" [src]="'/library' + (image.thumbUrl || image.url)" />
        </td>
        <td>
          <ul class="data-list">
            <li>
              <span class="label" i18n>Filename:</span>
              <span class="value">{{image.filename}}</span></li>
            <li>
              <span class="label" i18n>Size:</span> 
              <span class="value">
                {{image.width}}x{{image.height}}
                <span *ngIf="image.size"> @ {{image.size | size}}</span>
              </span>
            </li>
            <li>
              <span class="label" i18n>Url:</span> 
              <span class="value">{{image.url}}</span>
            </li>
            <li>
              <span class="label" i18n>Thumbnail url:</span>
              <span class="value">{{image.thumbUrl}}</span>
            </li>
            <li *ngIf="image.title">
              <span class="label" i18n>Title:</span> 
              <span class="value">{{image.title}}</span>
            </li>
            <li class="processing" *ngIf="image.processing">
              <span class="label" i18n>Processing</span>
              <div *ngVar="image.processing.source as source" class="step">
                Original (size={{source.width}}x{{source.height}}<span *ngIf="source.size"> @ {{source.size | size}}</span>, url={{source.url}})
              </div>
              <div *ngVar="image.processing.params.resize as resize" class="step">
                Resize (w={{resize.width}}, h={{resize.height}}, quality={{resize.quality}}, mode={{resize.mode}})
              </div>
              <div *ngVar="image.processing.output as output" class="step">
                Output (size={{output.width}}x{{output.height}}<span *ngIf="output.size"> @ {{output.size | size}}</span>, url={{output.url}})
              </div>
            </li>
          </ul>
        </td>
        <td class="actions">
          <i class="pi pi-bars" pReorderableRowHandle></i>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
<app-library-files-selector #libraryFilesSelector (selectFiles)="addImages($event)"></app-library-files-selector>
<p-confirmDialog i18n-header header="Confirmation" icon="pi pi-exclamation-triangle" width="425"
                 i18n-message message="Do you really want to delete this album?"></p-confirmDialog>
<app-album-create #albumModify [albums]="albums" (confirm)="onUpdateAlbum($event)" i18n-headerLabel headerLabel="Modify album"></app-album-create>
<app-batch-processing #batchProcessing (process)="onBatchProcessing($event)" (revert)="onBatchProcessingRevert($event)"></app-batch-processing>
